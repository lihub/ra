{% extends "base.html" %}

{% block title %}{{ content.risk_assessment('page_title') }}{% endblock %}

{% block content %}
<div class="assessment-container">
    <div class="assessment-header">
        <h1>{{ content.risk_assessment('header_title') }}</h1>
        <p>{{ content.risk_assessment('header_subtitle') }}</p>
    </div>

    <form id="risk-form" class="risk-form">
        <div class="form-section">
            <h3>{{ content.risk_assessment('investment_amount_title') }}</h3>
            <div class="input-group">
                <label for="investment_amount">{{ content.risk_assessment('investment_amount_label') }}</label>
                <input type="number" id="investment_amount" name="investment_amount" 
                       min="1000" step="1000" value="10000" required>
                <span class="currency">{{ content.risk_assessment('currency') }}</span>
            </div>
        </div>

        <!-- KYC Questions -->
        <div class="kyc-questions">
            <h3>Risk Assessment Questionnaire</h3>
            <p>Please answer the following questions to help us determine your optimal investment strategy.</p>
            
            <!-- Question 1: Time Horizon -->
            <div class="question-group">
                <h4>1. When do you expect to need the invested money?</h4>
                <div class="options">
                    <label><input type="radio" name="horizon_score" value="0" required> Within 1 year</label>
                    <label><input type="radio" name="horizon_score" value="20"> 1-3 years</label>
                    <label><input type="radio" name="horizon_score" value="50"> 4-7 years</label>
                    <label><input type="radio" name="horizon_score" value="75"> 8-15 years</label>
                    <label><input type="radio" name="horizon_score" value="100"> Over 15 years</label>
                </div>
            </div>

            <!-- Question 2: Loss Tolerance -->
            <div class="question-group">
                <h4>2. If your ₪100,000 investment drops to ₪75,000 in 6 months, what would you do?</h4>
                <div class="options">
                    <label><input type="radio" name="loss_tolerance" value="0" required> Sell immediately to prevent further losses</label>
                    <label><input type="radio" name="loss_tolerance" value="25"> Sell part of the investment</label>
                    <label><input type="radio" name="loss_tolerance" value="60"> Wait and do nothing</label>
                    <label><input type="radio" name="loss_tolerance" value="100"> Buy more at this discount</label>
                </div>
            </div>

            <!-- Question 3: Experience -->
            <div class="question-group">
                <h4>3. How did you behave during market crashes (2008, 2020)?</h4>
                <div class="options">
                    <label><input type="radio" name="experience_score" value="20" required> I was not invested then</label>
                    <label><input type="radio" name="experience_score" value="0"> I sold due to fear of losses</label>
                    <label><input type="radio" name="experience_score" value="70"> I held my investments</label>
                    <label><input type="radio" name="experience_score" value="100"> I bought more when prices fell</label>
                </div>
            </div>

            <!-- Question 4: Financial Capacity -->
            <div class="question-group">
                <h4>4. How much of your monthly income can you invest without affecting your lifestyle?</h4>
                <div class="options">
                    <label><input type="radio" name="financial_score" value="20" required> Up to 5%</label>
                    <label><input type="radio" name="financial_score" value="50"> 5-15%</label>
                    <label><input type="radio" name="financial_score" value="75"> 15-25%</label>
                    <label><input type="radio" name="financial_score" value="100"> Over 25%</label>
                </div>
            </div>

            <!-- Question 5: Investment Goal -->
            <div class="question-group">
                <h4>5. What is the main goal of this investment?</h4>
                <div class="options">
                    <label><input type="radio" name="goal_score" value="0" required> Capital preservation</label>
                    <label><input type="radio" name="goal_score" value="25"> Current income</label>
                    <label><input type="radio" name="goal_score" value="60"> Moderate growth</label>
                    <label><input type="radio" name="goal_score" value="100"> Maximum growth</label>
                </div>
            </div>

            <!-- Question 6: Sleep Test -->
            <div class="question-group">
                <h4>6. What portfolio decline would keep you awake at night?</h4>
                <div class="options">
                    <label><input type="radio" name="sleep_score" value="0" required> Over 5%</label>
                    <label><input type="radio" name="sleep_score" value="30"> Over 15%</label>
                    <label><input type="radio" name="sleep_score" value="70"> Over 25%</label>
                    <label><input type="radio" name="sleep_score" value="100"> Over 40%</label>
                </div>
            </div>

            <!-- Inconsistency Warnings -->
            <div id="kyc-warnings" class="warnings hidden">
                <h4>⚠️ Please Review Your Answers</h4>
                <div id="warning-messages"></div>
                <p><small>You can still proceed, but we recommend reviewing the flagged responses for better results.</small></p>
            </div>
        </div>

        <!-- Investment Duration (Hidden Field) -->
        <input type="hidden" name="investment_duration" value="10">

        <button type="submit" class="submit-button">
            {{ content.risk_assessment('calculate_button') }}
        </button>
    </form>

    <div id="portfolio-results" class="portfolio-results hidden">
        <h2>{{ content.risk_assessment('results_title') }}</h2>
        <div class="portfolio-summary">
            <div class="summary-stats">
                <div class="stat">
                    <h4>{{ content.risk_assessment('expected_return_label') }}</h4>
                    <span id="expected-return">-</span>
                </div>
                <div class="stat">
                    <h4>{{ content.risk_assessment('volatility_label') }}</h4>
                    <span id="volatility">-</span>
                </div>
                <div class="stat">
                    <h4>Sharpe Ratio</h4>
                    <span id="sharpe-ratio">-</span>
                </div>
            </div>
        </div>
        <div class="portfolio-chart">
            <canvas id="portfolioChart"></canvas>
        </div>
        <div class="portfolio-details" id="portfolio-details">
            <!-- Portfolio allocation details will be populated here -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/risk-assessment.js"></script>
{% endblock %}